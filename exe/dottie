#!/usr/bin/env ruby

require 'rubygems'
require 'commander/import'

require_relative '../lib/dottie'

program :name, 'dottie'
program :version, '0.0.1'
program :description, 'A dotfiles manager'

command :init do |c|
  c.syntax = 'dottie init [install location]'
  c.summary = 'Set up Dottie as your Dotfiles manager'
  c.example 'Set up Dottie in the default location (~/.dottie)', 'dottie init'
  c.example 'Set up Dottie at ~/.dotfiles', 'dottie init ~/.dotfiles'
  c.when_called do |args, _|
    dotfile_path = File.expand_path(args.first || '~/.dottie')

    begin
      puts "Setting up dottie at #{dotfile_path}"
      Dottie::Commands::Init.new.init(dotfile_path)
    rescue RuntimeError => e
      warn e.message
      exit 1
    end
  end
end

command :reset do |c|
  c.syntax = 'dottie reset'
  c.summary = 'Remove all Dottie files and settings'
  c.when_called do
    continue = ask(
      "<%= color('Warning', BOLD, YELLOW) %> This will remove all Dottie files and settings. Continue? [y/N] ",
      ->(yn) { yn.downcase[0] == "y" }
    ) do |q|
      q.validate                 = /\A(?:y(?:es)?|no?)?\Z/i
      q.responses[:not_valid]    = 'Please enter "yes" or "no".'
      q.responses[:ask_on_error] = :question
      q.completion               = %w[yes no]
    end
    exit unless continue

    Dottie::Commands::Reset.run
  end
end
